---
language: python
python:
  - "3.6"
services:
  - docker

install:
  - pip install pipenv
  - pipenv install --dev

script:
  - pipenv run molecule test

after_success:
  - true

before_deploy:
  - if [ -n "$TRAVIS_TAG" ]; then git archive HEAD -o $TRAVIS_TAG.tar.gz; fi
  - if [ -n "$TRAVIS_TAG" ]; then git archive HEAD -o $TRAVIS_TAG.zip; fi

deploy:
  provider: releases
  skip_cleanup: true
  prerelease: true
  name: $TRAVIS_TAG release
  file:
    - $TRAVIS_TAG.tar.gz
    - $TRAVIS_TAG.zip
  api_key:
    secure: QBfV53ur+n61pruhD30PD8CCp3R+M5fnl8+7J2vy7tzyspvtRMs3x9nJTihHAZ0Y4qjZ+fvQ2RsW80hONlMi+DaY+vrEqhhjZ4YHicaJV/tWzGAq4R6YjcA98OpW94R7i1LSMBh0+ncXzzLZnQeR/NzB7co1gkIXV5tKXZLQsL11Oz7cuJGGrFVdfhTXDgl+zTigno6nvyXHpSqDAoZ3p16wyp7vYtJicEkWa+YwsdYCnwuLjOg8jwrOvsUopH1UOnqRv5tOaFM01uXUIJqNU/Uy3AaaH7nD9J4pYhe9tHSSeITnsdiTa53IFVZrcVwrvZYftp9mGjCKQiZohDHvOJbQbSv2AojTRPeEYfum14+0kBYQmiRRVh5L2geEddXA7kU9waSF1GO9YvCJrEtDIfLTioxJXUxD0i5u2pq+ZJ0JV7D9WLdq54dR28tHZYXwOxe2WnwhCaax/WivFoYvtIL1FXybJcEF9d9tZCLgNUbABaLSfBrVQQ55Tx0mKqHQOccy3+E5t9PLVG6CFK2b9n5iogrnkOaz49/2cmVHYqiQwp1KYzYvCs7At9sTMv0+jlblVEikKuLSwpiyMszWpcAk8g8T236FwXxrBEHXnfuDjmrHxjK9HX91C16gTjeyu68T4XVVUbYTNsWLNEsJEnmIXrmhuy+EHoayIWrkk3w=
  on:
    repo: tulibraries/ansible-role-airflow
    tags: true
    branch:
      - master
      - /^v.*$/

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
